<!DOCTYPE html>
<html>

    <head>

    </head>
    <body>
        <audio id="player1" controls></audio>
        <button id="start">start</button><button id="stop">stop</button>

        <!-- <script src="https://cdn.jsdelivr.net/npm/opus-media-recorder@latest/OpusMediaRecorder.umd.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/opus-media-recorder@latest/encoderWorker.umd.js"></script> -->
        <script src="https://cdn.jsdelivr.net/npm/opus-media-recorder@0.7.16/OpusMediaRecorder.umd.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/opus-media-recorder@0.7.16/encoderWorker.umd.js"></script>
        <script type="module">
            const workerOptions = {
            OggOpusEncoderWasmPath: 'https://cdn.jsdelivr.net/npm/opus-media-recorder@0.7.16/OggOpusEncoder.wasm',
            WebMOpusEncoderWasmPath: 'https://cdn.jsdelivr.net/npm/opus-media-recorder@0.7.16/WebMOpusEncoder.wasm'
            };
            console.log(`support: ${window.MediaRecorder.isTypeSupported('audio/ogg;codecs=opus')}`);
            console.log(OpusMediaRecorder);
            window.MediaRecorder = OpusMediaRecorder;
            console.log(`support: ${window.MediaRecorder.isTypeSupported('audio/ogg;codecs=opus')}`);

            const player1 = document.querySelector("#player1");
            (async ()=>{
                const micMS = await navigator.mediaDevices.getUserMedia({audio:true, video: false});
                const MRecorder = new MediaRecorder(micMS, {
                    mimeType:"audio/ogg; codecs=opus",
                    // audioBitsPerSecond: 96*1000
                }, workerOptions);
                document.querySelector("#start").addEventListener("click", ()=> MRecorder.start());
                document.querySelector("#stop").addEventListener("click", ()=>MRecorder.stop());
                MRecorder.addEventListener('dataavailable', (evt) => {
                    console.log(evt);
                    player1.src = window.URL.createObjectURL(evt.data);
                });
            })();
        </script>
    </body>
</html>
